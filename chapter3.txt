This is chapter 3 version and maybe the final commit.